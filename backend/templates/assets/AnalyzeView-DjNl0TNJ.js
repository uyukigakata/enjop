import{d as z,r,e as M,f as P,g as R,c as g,b as a,w as J,v as O,h as l,i as p,n as C,t as k,F as N,j as U,k as b,u as E,l as I,o as c,m as $,p as W,_ as G}from"./index-C8RLOZmZ.js";import{_ as T}from"./enjop_logo-B52kueF_.js";import{_ as H}from"./enjo_kanki-CBA7zlio.js";import{a as j}from"./axios-upsvKRUO.js";import{L as K}from"./LawItem-CJBe4bOZ.js";import{V as Q,a as X,b as Y}from"./VContainer-iPdFlBS8.js";import{V as Z,a as ee,b as ae,c as oe,d as se,e as te}from"./VSpacer-DJCgZIzp.js";const le={key:0},re={class:"postView"},ne={class:"flex items-center justify-center flex-col mt-8"},ie={class:"fileupload"},ue={key:1},de={class:"resultView"},ce={class:"enjo_rate"},me={class:"mt-4 ml-4 mr-4 mb-4 p-4 rounded-lg bg-white"},ge={class:"justify-center flex flex-wrap flex-col"},pe={class:"m-4 ml-8 mr-8 p-4 border-2 border-gray-300 rounded-lg shadow-md bg-white"},ve={key:2},fe=z({__name:"AnalyzeView",setup(_e){const v=r(0);M();const x=E(),n=r(!1),i=r(!1),V=r(!1),m=r(""),u=r(null),t=r({laws:[{law_id:"0",law_name:"Law Name",law_reason:"This is Reason",law_risk_level:0},{law_id:"1",law_name:"Law Name",law_reason:"This is Reason",law_risk_level:1}],comment:"解析コメントあいうえお",rating:0}),S=o=>{var w;const s=((w=o.target.files)==null?void 0:w[0])||null;u.value=s},D=async()=>{n.value=!0,console.log("start isLoading",n.value),console.log("start dialog",i.value),await L(),n.value=!1,i.value=!0,console.log("end isLoading",n.value),console.log("end dialog",i.value)},L=async()=>{if(!u.value)return;const o=new FormData;o.append("file",u.value),o.append("content_str",m.value),console.log("file",u.value),console.log("content_str",m.value);try{V.value=!0;const e=await j.post("/api/process_video",o,{headers:{"Content-Type":"multipart/form-data"}});V.value=!1;const s=e.data.openai_risk_assessment;console.log("rist_text!!!!!!!!!!!!"),console.log(s);const w=s.replace(/\\n/g,"");t.value=JSON.parse(w),console.log("responseMessage.value!!!!!!!!!!!!"),console.log(t.value),n.value=!1,i.value=!0,console.log("mid isLoading",n.value),console.log("mid dialog",i.value);try{const d=JSON.parse(w);d.laws||(d.laws=[]),d.laws=d.laws.map(y=>({law_id:y.law_id??"N/A",law_name:y.law_name??"不明な法律",law_reason:y.law_reason??"理由なし",law_risk_level:y.law_risk_level??0})),t.value=d}catch(d){console.error("JSON parse error:",d),t.value={laws:[],comment:"解析結果を処理できませんでした",rating:0}}}catch(e){console.error(e),t.value={laws:[],comment:"An error occurred while processing the video",rating:0}}},B=()=>{v.value=1},h=P(()=>`bg-rate${t.value.rating}`),f=I(),_=r({laws:[],comment:"データなし",rating:2});R(()=>{if(console.log("route.query.laws:",f.query.laws),_.value.rating=Number(f.query.rating)||2,_.value.comment=String(f.query.comment||"データなし"),console.log(_.value.comment),f.query.laws)try{_.value.laws=JSON.parse(f.query.laws)}catch(o){console.error("Failed to parse laws:",o),_.value.laws=[]}});const F=()=>{v.value=2},A=()=>{x.push("/")};async function q(){if(!u.value)return;const o=new FormData;o.append("text",m.value),o.append("video",u.value),console.log("confirm text",m.value),console.log("confirm videoFile",u.value);try{const e=await j.post("/api/bluesky_post_video",o,{headers:{"Content-Type":"multipart/form-data"}});console.log(e.data),alert("動画をBlueskyに投稿しました")}catch(e){console.error(e)}x.push("/post-complete")}return(o,e)=>(c(),g(N,null,[v.value===0?(c(),g("div",le,[a("div",re,[a("div",ne,[e[3]||(e[3]=a("p",null,"1. テキストを入力",-1)),J(a("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),class:"mt-2 text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400",style:{height:"80px"}},null,512),[[O,m.value]]),a("div",ie,[e[2]||(e[2]=a("p",{class:"mt-4"},"2. 動画ファイルをここにアップロード",-1)),a("input",{type:"file",onChange:S,class:"mt-2 text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400"},null,32)]),a("button",{onClick:D,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-2"}," 投稿 ")]),l(Q,{class:"text-center"},{default:p(()=>[n.value?(c(),$(Y,{key:0,indeterminate:"",color:"blue",size:50,"aria-label":"ロード中"})):b("",!0)]),_:1}),l(Z,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),width:"500",class:"text-center",transition:"dialog-bottom-transition"},{default:p(()=>[l(ee,{class:C(["enjo_dialog",h.value])},{default:p(()=>[l(ae,null,{default:p(()=>[e[4]||(e[4]=a("p",{class:"dialog_kanki"},"ちょっと待って! この動画、炎上するかも...",-1)),a("p",null,"リスク評価: "+k(t.value.rating),1)]),_:1}),l(oe),l(se,{class:"cardActions"},{default:p(()=>[l(te),e[6]||(e[6]=a("img",{src:T,height:"90",alt:"logo"},null,-1)),l(X,{color:"blue darken-1",onClick:B},{default:p(()=>e[5]||(e[5]=[W(" 詳しく見る ")])),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])])])):v.value===1?(c(),g("div",ue,[a("div",de,[a("div",{class:C(["result min-h-screen",h.value])},[e[8]||(e[8]=a("div",{class:"flex items-center justify-center flex-col mt-8 w-full"},[a("img",{src:T,alt:"logo"})],-1)),a("div",ce,[a("p",null,"炎上レイト："+k(t.value.rating),1),e[7]||(e[7]=a("p",{class:"text-center text-xl"},"理由文",-1))]),a("div",null,[a("p",me,k(t.value.comment),1),a("ul",ge,[(c(!0),g(N,null,U(t.value.laws,s=>(c(),g("li",{key:s.law_id,class:"w-full mb-4"},[a("div",pe,[l(K,{law:s},null,8,["law"])])]))),128))])]),a("button",{class:"toConfirmPost",onClick:F},"投稿する")],2)])])):b("",!0),v.value===2?(c(),g("div",ve,[a("div",{class:"enjo_kanki_block"},[e[9]||(e[9]=a("h2",null,"このまま投稿すると",-1)),e[10]||(e[10]=a("div",{class:"flex items-center justify-center flex-col mt-8"},[a("img",{src:H,alt:"enjo_kanki"})],-1)),e[11]||(e[11]=a("p",{class:"finalCheck"},"本当に投稿しますか？",-1)),a("div",{class:"btnbox"},[a("button",{class:"noPostbtn",onClick:A},"投稿しない"),a("button",{class:"yesPostbtn",onClick:q},"投稿する")])])])):b("",!0)],64))}}),Ce=G(fe,[["__scopeId","data-v-2e58eca8"]]);export{Ce as default};
