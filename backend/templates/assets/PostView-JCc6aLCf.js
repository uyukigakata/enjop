import{d as V,e as C,r as d,f as h,c as N,b as s,w as T,v as D,h as t,i as u,u as L,o as _,m as S,k as A,n as B,t as J,p as O,_ as R}from"./index-C8RLOZmZ.js";import{_ as j}from"./enjop_logo-B52kueF_.js";import{a as z}from"./axios-upsvKRUO.js";import{V as F,a as M,b as P}from"./VContainer-iPdFlBS8.js";import{V as U,a as E,b as q,c as I,d as $,e as G}from"./VSpacer-DJCgZIzp.js";const H={class:"postView"},K={class:"flex items-center justify-center flex-col mt-8"},Q={class:"fileupload"},W=V({__name:"PostView",setup(X){C();const f=L(),r=d(!1),n=d(!1),v=d(!1),g=d(""),m=d(null),a=d({laws:[{law_id:"0",law_name:"Law Name",law_reason:"This is Reason",law_risk_level:0},{law_id:"0",law_name:"Law Name",law_reason:"This is Reason",law_risk_level:0}],comment:"解析コメント",rating:0}),w=o=>{var c;const l=((c=o.target.files)==null?void 0:c[0])||null;m.value=l},y=async()=>{r.value=!0,console.log("start isLoading",r.value),console.log("start dialog",n.value),await x(),r.value=!1,n.value=!0,console.log("end isLoading",r.value),console.log("end dialog",n.value)},x=async()=>{if(!m.value)return;const o=new FormData;o.append("file",m.value),o.append("content_str",g.value),console.log("file",m.value),console.log("content_str",g.value);try{v.value=!0;const e=await z.post("/api/process_video",o,{headers:{"Content-Type":"multipart/form-data"}});v.value=!1;const l=e.data.openai_risk_assessment;console.log("rist_text!!!!!!!!!!!!"),console.log(l);const c=l.replace(/\\n/g,"");a.value=JSON.parse(c),console.log("responseMessage.value!!!!!!!!!!!!"),console.log(a.value),r.value=!1,n.value=!0,console.log("mid isLoading",r.value),console.log("mid dialog",n.value);try{const i=JSON.parse(c);i.laws||(i.laws=[]),i.laws=i.laws.map(p=>({law_id:p.law_id??"N/A",law_name:p.law_name??"不明な法律",law_reason:p.law_reason??"理由なし",law_risk_level:p.law_risk_level??0})),a.value=i}catch(i){console.error("JSON parse error:",i),a.value={laws:[],comment:"解析結果を処理できませんでした",rating:0}}}catch(e){console.error(e),a.value={laws:[],comment:"An error occurred while processing the video",rating:0}}},k=()=>{const o=JSON.stringify(a.value.laws);f.push({path:"/result",query:{rating:a.value.rating,comment:a.value.comment,laws:o}})},b=h(()=>`bg-rate${a.value.rating}`);return(o,e)=>(_(),N("div",H,[s("div",K,[e[3]||(e[3]=s("p",null,"1. テキストを入力",-1)),T(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),class:"mt-2 text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400",style:{height:"80px"}},null,512),[[D,g.value]]),s("div",Q,[e[2]||(e[2]=s("p",{class:"mt-4"},"2. 動画ファイルをここにアップロード",-1)),s("input",{type:"file",onChange:w,class:"mt-2 text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400"},null,32)]),s("button",{onClick:y,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-2"}," 投稿 ")]),t(F,{class:"text-center"},{default:u(()=>[r.value?(_(),S(P,{key:0,indeterminate:"",color:"blue",size:50,"aria-label":"ロード中"})):A("",!0)]),_:1}),t(U,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value=l),width:"500",class:"text-center",transition:"dialog-bottom-transition"},{default:u(()=>[t(E,{class:B(["enjo_dialog",b.value])},{default:u(()=>[t(q,null,{default:u(()=>[e[4]||(e[4]=s("p",{class:"dialog_kanki"},"ちょっと待って! この動画、炎上するかも...",-1)),s("p",null,"リスク評価: "+J(a.value.rating),1)]),_:1}),t(I),t($,{class:"cardActions"},{default:u(()=>[t(G),e[6]||(e[6]=s("img",{src:j,height:"90",alt:"logo"},null,-1)),t(M,{color:"blue darken-1",onClick:k},{default:u(()=>e[5]||(e[5]=[O(" 詳しく見る ")])),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])]))}}),oe=R(W,[["__scopeId","data-v-da5f637a"]]);export{oe as default};
